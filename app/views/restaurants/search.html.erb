<%= javascript_include_tag "dropdown.js", defer: true %>
<%= javascript_include_tag "switch-views.js", defer: true %>

<% @current_user = User.find_by_id(session[:user_id]) %>

<div class="search-options-bar">
    <!--- <input type="text" placeholder="Search..."> -->
    <%= form_with url: "/search", method: :get do |form| %>
        <%= form.text_field :search %>
        <% if @current_user %>
            <%= form.hidden_field :gluten_req, value: @current_user.gluten_intolerance %>
            <%= form.hidden_field :vegan_req, value: @current_user.vegan %>
            <%= form.hidden_field :vegetarian_req, value: @current_user.vegetarian %>
            <%= form.hidden_field :nut_allergy_req, value: @current_user.nut_allergy %>
            <%= form.hidden_field :fish_allergy_req, value: @current_user.fish_allergy %>
            <%= form.hidden_field :egg_allergy_req, value: @current_user.egg_allergy %>
            <%= form.hidden_field :soy_allergy_req, value: @current_user.soy_allergy %>
            <%= form.hidden_field :dairy_allergy_req, value: @current_user.dairy_allergy %>
            <%= form.hidden_field :kosher_req, value: @current_user.kosher %>
            <%= form.hidden_field :halal_req, value: @current_user.halal %>
        <% else %>
            <%= form.hidden_field :gluten_req, value: false %>
            <%= form.hidden_field :vegan_req, value: false %>
            <%= form.hidden_field :vegetarian_req, value: false %>
            <%= form.hidden_field :nut_allergy_req, value: false %>
            <%= form.hidden_field :fish_allergy_req, value: false %>
            <%= form.hidden_field :egg_allergy_req, value: false %>
            <%= form.hidden_field :soy_allergy_req, value: false %>
            <%= form.hidden_field :dairy_allergy_req, value: false %>
            <%= form.hidden_field :kosher_req, value: false %>
            <%= form.hidden_field :halal_req, value: false %>
        <% end %>
        <!--- <%= form.submit "Search" %> -->
    <% end %>

    <div class="dropdown">
        <button onclick="OpenFilters()" class="filters-button">Filters</button>
        <div id="filters" class="filters-content">
            <p>test1</p>
            <p>test2</p>
            <p>test3</p>
        </div>
    </div>

    <div class="dropdown">
        <button onclick="OpenSortBy()" class="sorting-button">Sort By</button>
        <div id="sorting" class="sorting-methods">
            <p>test1</p>
            <p>test2</p>
            <p>test3</P>
        </div>
    </div>
</div>
<div class="main-content">
    <div class="sidebar">
        <h2 class="results">Results</h2>

        <!--- somehow use embedded ruby for loop to display returned restaurants using the sidebar-element partial-->
        <% @restaurants.each do |restaurant| %>
            <button onclick="SwitchRestaurantView(<%= restaurant.id %>)" class="sidebar-element">
                <p class="restaurant-name"><%= restaurant.name %></p>

                <div class="address-ratings">
                    <p class = "address"><%= restaurant.address %></p>
                    <p class = "ratings"> <%= restaurant.rating%> </p>
                </div>

                <div class="tags-cuisine">
                    <p class="tags"><%= restaurant.tags %></p>

                    <p class="cuisine">Cuisine: <%= restaurant.cuisine%></p>
                </div>
            </button>
        <% end %>
        
    </div>

    <div class="large-view">
        <!--- these two divs should completely overlap, and use javascript to show or hide one depending on whether a restaurant is selected or not -->
        <% @restaurants.each do |restaurant| %>
            <div id="<%= restaurant.id %>"class="restaurant-view">
                <!--- use this one for the restaurant page -->
                <h1 class="view-name"><%= restaurant.name %></h1>

                <div class="image-gallery">
                    <img src="<%= restaurant.image %>">
                </div>

                <div class="info-bar">
                    <p class="view-address"><%= restaurant.address %></p>
                    <p class="view-rating">Rating: <%= restaurant.rating %></p>
                    <P class="view-owner">Owner: <%= restaurant.owner %></p>
                    <p class="view-cuisine">Cuisine: <%= restaurant.cuisine %></p><br>
                    <p class="view-hours">Hours: <%= restaurant.hours %></p>
                </div>

                <div class="description-div">
                    <P class="description"><%= restaurant.description %></p>
                </div>
            </div>
        <% end %>

        <div id="map" class="map-view show">
            <!--- use this one for the map view page -->
            <%= js_map [{latitude: 37.7829, longitude: -122.4190}] %>
        </div>
    </div>
</div>
